name: Build on Change

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main

jobs:
  build-linux:
    runs-on: ubuntu-latest
    name: Linux (gcc-15)

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install gcc-15
        run: |
          sudo apt-get update
          sudo apt-get install -y software-properties-common
          sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
          sudo apt-get update
          sudo apt-get install -y gcc-15 g++-15

      - name: Install Xmake
        run: |
          sudo apt-get update
          sudo apt-get install -y xmake

      - name: Configure Project
        run: |
          cd ${{ github.workspace }}
          xmake f --cc=gcc-15 --cxx=g++-15 -c

      - name: Build
        if: success()
        run: |
          cd ${{ github.workspace }}
          xmake

  build-windows:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install xmake
        run: |
          choco install xmake

      - name: Configure Project
        run: |
          cd ${{ github.workspace }}
          xmake f -c

      - name: Build
        if: success()
        run: |
          cd ${{ github.workspace }}
          xmake